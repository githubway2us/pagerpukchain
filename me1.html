@app.get("/", response_class=HTMLResponse)
async def web_interface():
    conn = sqlite3.connect(DB_NAME)
    
    # ‡∏î‡∏∂‡∏á‡∏ö‡∏•‡πá‡∏≠‡∏Å‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î 15 ‡∏≠‡∏±‡∏ô
    blocks = conn.execute(
        "SELECT idx, timestamp, data, hash FROM blockchain ORDER BY idx DESC LIMIT 15"
    ).fetchall()
    
    # ‡∏ô‡∏±‡∏ö‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ö‡∏•‡πá‡∏≠‡∏Å‡∏Å‡∏≤‡∏£‡∏Ç‡∏∏‡∏î (MINED:)
    mining_blocks = conn.execute(
        "SELECT COUNT(*) FROM blockchain WHERE data LIKE 'MINED:%'"
    ).fetchone()[0]
    
    total_mined_coins = mining_blocks * 50
    
    total_users = conn.execute("SELECT COUNT(*) FROM users").fetchone()[0]
    
    rich_list = conn.execute(
        "SELECT pager_id, balance FROM users ORDER BY balance DESC LIMIT 5"
    ).fetchall()
    
    conn.close()

    # ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏ñ‡∏ß‡∏ö‡∏•‡πá‡∏≠‡∏Å (highlight ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô mining block)
    block_rows = ""
    for b in blocks:
        is_mine = "color: #ffeb3b; font-weight: bold; background: rgba(255,235,59,0.08);" if "MINED:" in b[2] else ""
        block_rows += f"""
        <tr style="{is_mine}">
            <td>{b[0]}</td>
            <td>{time.strftime('%Y-%m-%d %H:%M:%S', time.localtime(b[1]))}</td>
            <td>{b[2][:80]}{'...' if len(b[2]) > 80 else ''}</td>
            <td><code>{b[3][:16]}...</code></td>
        </tr>
        """

    rich_rows = "".join([
        f"<li>{r[0]} ‚Äî <b>{r[1]:,} PUK</b></li>"
        for r in rich_list
    ]) or "<li>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</li>"

    return f"""
    <!DOCTYPE html>
    <html lang="th">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>PUK Pager Network - Blockchain Explorer</title>
        <style>
            body {{
                font-family: 'Courier New', Courier, monospace;
                background: #0a0a0a url('https://6976c68bc7e0142b26c0c3ef.imgix.net/Japanese-anime-style-illustration-of-school-kids-in-1990s-Japan-using-pagers-(beepers),-one-anime-boy-looking-surprised-while-pressing-buttons-and-reading-the-pager-screen,-several-other-students-standing-nearby-with-pagers-clipped-on-their-waist-belts,-nostalgic-atmosphere,-Japanese-high-school-uniforms,-expressive-faces,-soft-lighting,-detailed-anime-art,-vibrant-colors,-clean-line-art,-slice-of-life-scene,-background-of-Japanese-street,-cinematic-composition,-high-detail,-4k-508603.png') no-repeat center center fixed;
                background-size: cover;
                color: #00ff9d;
                margin: 0;
                padding: 20px;
                min-height: 100vh;
                position: relative;
            }}

            body::before {{
                content: "";
                position: absolute;
                inset: 0;
                background: rgba(10, 20, 10, 0.70);
                z-index: -1;
            }}

            .container {{
                max-width: 1100px;
                margin: 0 auto;
                background: rgba(0, 0, 0, 0.60);
                border: 2px solid #00ff9d;
                border-radius: 12px;
                padding: 25px;
                box-shadow: 0 0 35px rgba(0, 255, 157, 0.25);
                backdrop-filter: blur(5px);
            }}

            h1 {{
                text-align: center;
                color: #8fb339;
                text-shadow: 0 0 12px #8fb339;
                margin-bottom: 25px;
            }}

            h3 {{
                color: #8fb339;
                margin-top: 30px;
            }}

            .tabs {{
                display: flex;
                flex-wrap: wrap;
                gap: 6px;
                margin-bottom: 25px;
            }}

            .tab {{
                padding: 10px 22px;
                cursor: pointer;
                background: rgba(0, 255, 157, 0.12);
                border: 1px solid #00ff9d;
                border-radius: 6px 6px 0 0;
                color: #00ff9d;
                transition: all 0.25s;
            }}

            .tab:hover {{ background: rgba(0, 255, 157, 0.25); }}
            .tab.active {{ background: rgba(0, 255, 157, 0.35); font-weight: bold; }}

            .tab-content {{
                display: none;
                padding: 20px;
                background: rgba(0, 0, 0, 0.45);
                border: 1px solid #333;
                border-radius: 0 8px 8px 8px;
            }}

            .tab-content.show {{ display: block; }}

            .audit-bar {{
                display: flex;
                flex-wrap: wrap;
                gap: 20px;
                margin-bottom: 30px;
                padding: 20px;
                background: rgba(0, 255, 157, 0.12);
                border: 1px solid #00ff9d;
                border-radius: 10px;
                text-align: center;
            }}

            .stat-item {{
                flex: 1 1 200px;
            }}

            .stat-label {{
                font-size: 0.85em;
                color: #8fb339;
            }}

            .stat-value {{
                font-size: 2em;
                font-weight: bold;
                color: #ffffff;
                text-shadow: 0 0 10px #00ff9d;
            }}

            table {{
                width: 100%;
                border-collapse: collapse;
                margin: 15px 0;
                font-size: 0.9em;
            }}

            th, td {{
                border: 1px solid #444;
                padding: 10px;
                text-align: left;
            }}

            th {{
                background: #1a1a1a;
                color: #8fb339;
            }}

            tr:hover {{ background: rgba(0, 255, 157, 0.08); }}

            input, button {{
                width: 100%;
                padding: 12px;
                margin: 8px 0;
                border-radius: 6px;
                font-size: 1em;
            }}

            input {{
                background: #111;
                color: #00ff9d;
                border: 1px solid #00ff9d;
            }}

            button {{
                background: #00ff9d;
                color: black;
                border: none;
                font-weight: bold;
                cursor: pointer;
            }}

            button:hover {{ background: #00cc7a; }}

            .info-box {{
                background: rgba(143, 179, 57, 0.15);
                border-left: 5px solid #8fb339;
                padding: 15px;
                margin: 15px 0;
                border-radius: 6px;
            }}

            ul {{ padding-left: 20px; list-style: none; }}
            li {{ margin: 6px 0; }}
            .logo-pager {{
    display: block;
    margin: 0 auto 20px auto;          /* ‡∏Å‡∏∂‡πà‡∏á‡∏Å‡∏•‡∏≤‡∏á + ‡∏ä‡πà‡∏≠‡∏á‡∏ß‡πà‡∏≤‡∏á‡∏•‡πà‡∏≤‡∏á */
    max-width: 280px;                  /* ‡∏Ç‡∏ô‡∏≤‡∏î‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î‡∏ö‡∏ô‡∏à‡∏≠‡πÉ‡∏´‡∏ç‡πà (‡∏õ‡∏£‡∏±‡∏ö‡πÑ‡∏î‡πâ 240-320px ‡∏ï‡∏≤‡∏°‡∏ä‡∏≠‡∏ö) */
    width: 90%;                        /* ‡πÉ‡∏´‡πâ responsive ‡πÑ‡∏°‡πà‡πÄ‡∏ï‡πá‡∏°‡∏à‡∏≠‡πÄ‡∏Å‡∏¥‡∏ô */
    height: auto;
    filter: drop-shadow(0 0 15px #00ff9d) brightness(1.15);  /* neon glow ‡πÄ‡∏Ç‡πâ‡∏°‡∏Ç‡∏∂‡πâ‡∏ô‡∏ô‡∏¥‡∏î */
    border-radius: 16px;               /* ‡∏°‡∏∏‡∏°‡πÇ‡∏Ñ‡πâ‡∏á‡∏™‡∏ß‡∏¢ */
    transition: transform 0.4s ease, filter 0.4s ease;
}}

.logo-pager:hover {{
    transform: scale(1.08);
    filter: drop-shadow(0 0 28px #00ff9d) brightness(1.3);
}}
        </style>
    </head>
    <body>
<div style="text-align: center; margin-bottom: 25px;">
    <img src="https://pngimg.com/d/pager_PNG23.png" 
         alt="Retro Motorola Pager - PUK Network" 
         class="logo-pager"
         style="max-height: 180px;">  <!-- ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏π‡∏á‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏Ç‡∏ô‡∏≤‡∏î‡∏à‡∏£‡∏¥‡∏á -->
</div>
<h1 style="margin-top: 0; font-size: 2.2em;"> PUK PAGER NETWORK v6.5</h1>


        <div class="tabs">
            <div class="tab active" onclick="openTab('explorer')">EXPLORER</div>
            <div class="tab" onclick="openTab('register')">REGISTER</div>
            <div class="tab" onclick="openTab('howtouse')">HOW TO USE</div>
            <div class="tab" onclick="openTab('blockchain')">WHAT IS BLOCKCHAIN?</div>
        </div>

        <div id="explorer" class="tab-content show">
            <div class="audit-bar">
                <div class="stat-item">
                    <div class="stat-label">TOTAL CIRCULATING SUPPLY</div>
                    <div class="stat-value">{total_mined_coins:,} PUK</div>
                    <div style="font-size:0.75em; color:#aaa;">(‡∏à‡∏≤‡∏Å {mining_blocks:,} ‡∏ö‡∏•‡πá‡∏≠‡∏Å‡∏Å‡∏≤‡∏£‡∏Ç‡∏∏‡∏î)</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">REGISTERED PAGERS</div>
                    <div class="stat-value">{total_users:,} IDs</div>
                </div>
            </div>

            <h3>üîó RECENT BLOCKS (15 ‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î)</h3>
            <table>
                <tr>
                    <th>BLOCK</th>
                    <th>TIME</th>
                    <th>DATA / TX</th>
                    <th>HASH</th>
                </tr>
                {block_rows}
            </table>

        </div>

        <div id="register" class="tab-content">
            <h3>‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡πÄ‡∏û‡∏à‡πÄ‡∏à‡∏≠‡∏£‡πå‡πÉ‡∏´‡∏°‡πà</h3>
            <form action="/register" method="post">
                <label>ID (‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö 01-XXXX):</label>
                <input type="text" name="pager_id" required pattern="\\d{{2}}-\\d{{4}}" placeholder="01-2026">
                <label>‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô (‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡πà‡∏≥ 6 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£):</label>
                <input type="password" name="password" required minlength="6">
                <button type="submit">‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ö‡∏±‡∏ç‡∏ä‡∏µ</button>
            </form>
            <p style="font-size:0.85em; color:#aaa; margin-top:12px;">
                * ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÉ‡∏ô‡∏ö‡∏•‡πá‡∏≠‡∏Å‡πÄ‡∏ä‡∏ô‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ñ‡∏≤‡∏ß‡∏£
            </p>
        </div>

        <div id="howtouse" class="tab-content">
            <h3>‡∏Ñ‡∏π‡πà‡∏°‡∏∑‡∏≠‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</h3>
            <div class="info-box">
                <strong>1. ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</strong> ‚Üí ‡πÉ‡∏ä‡πâ ID + Password ‡πÉ‡∏ô Pager Client<br>
                <strong>2. ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°</strong> ‚Üí Menu ‚Üí 1 ‚Üí ‡πÉ‡∏™‡πà ID ‡∏õ‡∏•‡∏≤‡∏¢‡∏ó‡∏≤‡∏á + ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°<br>
                <strong>3. ‡∏Ç‡∏∏‡∏î‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç</strong> ‚Üí Menu ‚Üí 3 ‚Üí ‡πÄ‡∏£‡∏¥‡πà‡∏° Proof-of-Work ‡πÑ‡∏î‡πâ 50 PUK/‡∏ö‡∏•‡πá‡∏≠‡∏Å<br>
                <strong>4. ‡πÄ‡∏Å‡∏°</strong> ‚Üí ‡πÄ‡∏•‡πà‡∏ô Snake / Tetris ‡∏à‡∏≤‡∏Å‡πÄ‡∏°‡∏ô‡∏π (‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏≠‡∏≤‡∏à‡∏ï‡∏¥‡∏î leaderboard ‡πÉ‡∏ô‡∏≠‡∏ô‡∏≤‡∏Ñ‡∏ï)
            </div>
            <h3>English Manual</h3>
            <div class="info-box">
                Login with registered ID/PW.<br>
                Send msg: Menu ‚Üí 1.<br>
                Mine: Menu ‚Üí 3 (50 PUK reward per block).
            </div>
        </div>

        <div id="blockchain" class="tab-content">
            <h3>‡∏ö‡∏•‡πá‡∏≠‡∏Å‡πÄ‡∏ä‡∏ô‡∏Ñ‡∏∑‡∏≠‡∏≠‡∏∞‡πÑ‡∏£?</h3>
            <div class="info-box">
                ‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏°‡∏∏‡∏î‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏î‡∏¥‡∏à‡∏¥‡∏ó‡∏±‡∏•‡πÅ‡∏ö‡∏ö‡∏Å‡∏£‡∏∞‡∏à‡∏≤‡∏¢‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏ó‡∏µ‡πà‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ<br>
                ‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏ö‡∏•‡πá‡∏≠‡∏Å‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏î‡πâ‡∏ß‡∏¢ hash ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏¢‡πâ‡∏≠‡∏ô‡∏´‡∏•‡∏±‡∏á‡πÑ‡∏î‡πâ‡πÅ‡∏•‡∏∞‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢<br>
                ‡∏Å‡∏≤‡∏£‡∏Ç‡∏∏‡∏î‡πÉ‡∏ä‡πâ‡∏û‡∏•‡∏±‡∏á‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ò‡∏∏‡∏£‡∏Å‡∏£‡∏£‡∏°‡πÅ‡∏•‡∏∞‡∏£‡∏±‡∏Å‡∏©‡∏≤‡πÄ‡∏Ñ‡∏£‡∏∑‡∏≠‡∏Ç‡πà‡∏≤‡∏¢
            </div>
            <h3>What is Blockchain?</h3>
            <div class="info-box">
                Decentralized immutable ledger.<br>
                Blocks linked by cryptographic hashes.<br>
                Secured via Proof-of-Work mining.
            </div>
        </div>
    </div>

    <script>
        function openTab(tabId) {{
            document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('show'));
            document.querySelectorAll('.tab').forEach(el => el.classList.remove('active'));
            document.getElementById(tabId).classList.add('show');
            event.currentTarget.classList.add('active');
        }}
    </script>
    </body>
    </html>
    """